FROM ruby:3.3


RUN apt-get update -qq \
    && apt-get install -y --no-install-recommends \
    build-essential \
    libpq-dev \
    git \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY Gemfile Gemfile.lock .ruby-version ./
RUN gem install bundler \
    && bundle install --jobs 4 --retry 3

COPY . .

ENV RACK_ENV=test

# Default command is a shell; CI or developers override it, e.g.:
#   docker compose -f docker-compose.test.yml run --rm app bundle exec rspec
CMD ["bash"]